



代码地址：https://github.com/Ydkkdeshuai/28377

## 时钟

![时钟](../pic/image-20240909211213789.png)

时钟源：

>INTOSC2：内部时钟、用来执行ROM程序。缺点：不精准，CAN、USB外设要求比较高达不到。

>INTOSC1：用于看门狗、丢失时钟检测电路

>外部晶振：三种接法。**无脑用这个就对了**

> AUXCLKIN： IO口支持的外部时钟

![时钟连接表](../pic/image-20240909212930792.png)

时钟计算：

![时钟计算](../pic/image-20240909213418027.png)



## pwm



**TB：**

![TB](../pic/image-20240909221326494.png)

配置功能：

> 确定分频得到时钟频率，确定TBCTR确定触发事件

> 是否触发中断信号 Zero PRD

> 计数方向

> 和其他模块的关系

![TB模块寄存器](../pic/image-20240909222055702.png)

**周期计算：**

![上升 下降 周期计算](../pic/image-20240909222407262.png)

$T =(TBPRD + 1)/T_{TBCLK}$ 

![上下计数](../pic/image-20240909222503282.png)

$T =(TBPRD*2)/T_{TBCLK}$ 

TBCTL[PRDLD]：开关TBPRD影子寄存器0开。



**配置步骤：**

> 使能时钟

> 关闭TBPRD计数，TBCLKSYNC = 0；

> 配置epwm

> 开TBPRD计数，TBCLKSYNC = 1；

![时钟同步功能](../pic/image-20240909223417820.png)

TBCTL[PHSEN]：1开启同步(加载TBPHS到TBCTR)。 同步信号有三类。

### **CC模块**

![CC模块 在 epwm中结构](../pic/image-20240910130911664.png)

**功能：输出比较事件：**

> CTR=CMPA、CMPB、CMPC、CMPD

> CTR=PRD

> CTR=ZERO

**CC模块**

![CC模块 结构详细图](../pic/image-20240910131415102.png)



### AQ 子模块

功能：根据  事件 信号 产生 不同动作。

![AQ 详细图](../pic/image-20240910132230802.png)



触发事件：

![image-20240910132310512](../pic/image-20240910132310512.png)

执行操作：1 、0 、翻转 、 啥也不做

### DB 模块

功能：

> 添加 上升延时时间  下降延时时间 

![模块 详细图](../pic/image-20240910135532540.png)

**PC 模块**



**TZ 模块**



**ET 模块**



**DC 模块**



### 多epwm同步

![同步信号框图](../pic/image-20240913173329598.png)

代码如下：

```C
    //EPWM同步配置
    EALLOW;
    SyncSocRegs.SYNCSELECT.bit.EPWM4SYNCIN = 0;     //EPWM1输出同步EPWM4
    SyncSocRegs.SYNCSELECT.bit.EPWM7SYNCIN = 0;     // EPWM1 同步EPWM7
    SyncSocRegs.SYNCSELECT.bit.EPWM10SYNCIN = 0;    // EPWM1 同步EPWM10
    EPwm1Regs.TBCTL.bit.SYNCOSEL   = TB_CTR_ZERO;	// EPWM1 输出同步信号
    EDIS;

	EPwm2Regs.TBCTL.bit.PHSEN = TB_ENABLE;   		// EPWM2 接收同步信号
```

![寄存器表](../pic/image-20240913175817149.png)

![ePWM1输出同步信号](../pic/image-20240913180119928.png)

## 定时器



## 中断



## ADC



## Can 模块



### **Can通信协议**



### **28377Can模块配置**

![CAN 模块框图](../pic/image-20240910195821827.png)

